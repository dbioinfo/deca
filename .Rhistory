sra_id <- "SRR8615034"
# Get the full record in XML
rec <- entrez_fetch(db="sra", id=sra_id, rettype="runinfo", retmode="text")
run_info <- read.csv(text=rec)
head(run_info)
ena_url <- paste0(
"https://www.ebi.ac.uk/ena/portal/api/filereport?accession=",
sra_id,
"&result=read_run",
"&fields=run_accession,sample_accession,experiment_accession,study_accession,",
"sample_title,scientific_name,experiment_title,library_strategy,library_source,library_layout,fastq_ftp",
"&format=tsv&limit=0"
)
meta <- fread(ena_url)
print(meta)
rnai %>% filter(cell_line %in% final_lines) %>% nrow()
colnames(rnai)
rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A') %>% nrow()
rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A') %>% head()
rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% head()
rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% nrow()
crispr %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% nrow()
crispr %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% head()
crispr %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% pull(depmap_id) %>% unique() %>% length()
runs_df
#agg final metadata
subrnai <- rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% mutate(screen='rnai')
subcrispr <- crispr %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% mutate(screen='crispr')
subruns <- runs_df %>% filter(sample_title %in% final_lines)
#agg final metadata
subrnai <- rnai %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% mutate(screen='rnai') %>% rename(rnai_dependency=dependency)
subrnai %>% select(cell_line, gene_name, rnai_dependency) %>% unique()
subruns %>% rename(cell_line=sample_title) %>% heaD()
subruns %>% rename(cell_line=sample_title) %>% head()
mfinal <- merge(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, gene_name, rnai_dependency) , by='cell_line')
mfinal <- merge(mfinal, subcrispr %>% select(cell_line, gene_name, crispr_dependency) , by='cell_line')
subcrispr <- crispr %>% filter(cell_line %in% final_lines, gene_name=='KIF18A', !is.na(dependency)) %>% mutate(screen='crispr') %>% rename(crispr_dependency=dependency)
mfinal <- merge(mfinal, subcrispr %>% select(cell_line, gene_name, crispr_dependency) , by='cell_line')
mfinal <- merge(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, gene_name, rnai_dependency) , by='cell_line')
mfinal <- left_join(mfinal, subcrispr %>% select(cell_line, crispr_dependency) , by='cell_line')
mfinal <- left_join(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, gene_name, rnai_dependency) , by='cell_line')
mfinal <- left_join(mfinal, subcrispr %>% select(cell_line, crispr_dependency) , by='cell_line')
mfinal %>% filter(!is.na(crispr_dependency) | !is.na(rnai_dependency)) %>% nrow()
mfinal %>% filter(!is.na(crispr_dependency)) %>% nrow()
mfinal %>% filter( !is.na(rnai_dependency)) %>% nrow()
write_csv(mfinal, 'WorkForaging/technium/apeiron/orf1/depmap_KIF18A_metadata.csv')
run_info
runs_df %>% head()
runs_df %>% pull(library_strategy) %>% unique()
subruns <- runs_df %>% filter(sample_title %in% final_lines, library_strategy=="RNA-Seq")
mfinal <- left_join(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, gene_name, rnai_dependency) , by='cell_line')
mfinal <- left_join(mfinal, subcrispr %>% select(cell_line, crispr_dependency) , by='cell_line')
write_csv(mfinal, 'WorkForaging/technium/apeiron/orf1/depmap_KIF18A_metadata.csv')
mfinal[1,]
View(mfinal)
mfinal <- left_join(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, rnai_dependency) , by='cell_line')
mfinal <- left_join(mfinal, subcrispr %>% select(cell_line, crispr_dependency) , by='cell_line')
mfinal %>% nrow()
mfinal %>% filter(!is.na(crispr_dependency)) %>% nrow()
mfinal %>% filter(!is.na(crispr_dependency) | !is.na(rnai_dependency)) %>% nrow()
mfinal <- left_join(subruns %>% rename(cell_line=sample_title), subrnai %>% select(cell_line, rnai_dependency) , by='cell_line')
mfinal <- left_join(mfinal, subcrispr %>% select(cell_line, crispr_dependency) , by='cell_line')  %>% filter(!is.na(crispr_dependency) | !is.na(rnai_dependency))
write_csv(mfinal, 'WorkForaging/technium/apeiron/orf1/depmap_KIF18A_metadata.csv')
run_info
mfinal[1,]
#check individual sra
sra_id <- "SRR8615223"
rec <- entrez_fetch(db="sra", id=sra_id, rettype="runinfo", retmode="text")
run_info <- read.csv(text=rec)
head(run_info)
#check for genome assembly
sra_id <- "SRR8615223"
sra_out <- data.frame(AssemblyName=NULL, download_path=NULL, sra_id=NULL)
rec <- entrez_fetch(db="sra", id=sid, rettype="runinfo", retmode="text")
#check for genome assembly
sid <- "SRR8615223"
rec <- entrez_fetch(db="sra", id=sid, rettype="runinfo", retmode="text")
run_info <- read.csv(text=rec)
sra_out <- rbind(sra_out, run_info %>% select(AssemblyName, download_path) %>% mutate(sra_id=sid))
sra_out
mfinal[2,]
#check for genome assembly
sid <- "SRR8615224"
rec <- entrez_fetch(db="sra", id=sid, rettype="runinfo", retmode="text")
run_info <- read.csv(text=rec)
sra_out <- rbind(sra_out, run_info %>% select(AssemblyName, download_path) %>% mutate(sra_id=sid))
sra_out
sra_out <- data.frame(AssemblyName=NULL, download_path=NULL, sra_id=NULL)
for (sid in mfinal$run_accession){
rec <- entrez_fetch(db="sra", id=sid, rettype="runinfo", retmode="text")
run_info <- read.csv(text=rec)
sra_out <- rbind(sra_out, run_info %>% select(AssemblyName, download_path) %>% mutate(sra_id=sid))
}
tmfinal <- left_join(mfinal, sra_out, by='sra_id')
mfinal
tmfinal <- left_join(mfinal %>% rename(sra_id=run_accession), sra_out, by='sra_id')
write_csv(tmfinal, 'WorkForaging/technium/apeiron/orf1/depmap_KIF18A_metadata.csv')
data <- readRDS('Postdoc/Hindle/ana/tmp/cor.rds')
head(data)
library(tidyverse)
data %>% filter(p<0.1)
data %>% filter(P<0.1)
data %>% filter(P<0.05)
data %>% filter(P<0.05) %>% summary(Rho)
data %>% filter(P<0.05, Rho<0) %>% nrow()
data %>% filter(P<0.05, Rho>0) %>% nrow()
data %>% filter(P<0.05, Rho>0) %>% arrange(-P) %>% head()
data %>% filter(P<0.05, Rho>0) %>% arrange(P) %>% head()
rdata <- readRDS('Postdoc/Hindle/ana/tmp/RERw.rds')
head(rdata)
dim(rdata)
rownames(rdata) %>% head()
rdata["EIF3D",]
library(tidyverse)
edat <- read_csv('WorkForaging/technium/apeiron/orf1/depmap_KIF18A_orf1_expr.csv')
mdat <- read_csv('WorkForaging/technium/apeiron/orf1/depmap_KIF18A_metadata.csv')
edat <- read_csv('WorkForaging/technium/apeiron/orf1/depmap_KIF18A_orf1_expr.csv') %>% rename(sra_id=SRAid)
tdat <- left_join(edat, mdat, by='sra_id')
head(tdat)
tdat %>% select(cell_line) %>% unique()
cell_lines <- tdat %>% select(cell_line) %>% unique()
View(cell_lines)
cell_types <- c("LUNG","STOMACH","UTERUS", "THYROID","CNS","LIVER","BONE","BLOOD","SOFT_TISS", "PANCREAS","KIDNEY","SKIN","BREAST")
tdat %>% filter(grepl('ENDO',cell_line))
tdat %>% filter(grepl('ENDO',cell_line)) %>% pull(cell_line)
tdat %>% filter(grepl('LUNG',cell_line)) %>% pull(cell_line)
stomgroup <- tdat %>% filter(grepl('STOMACH',cell_line)) %>% pull(cell_line)
stomgroup <- tdat %>% filter(grepl('STOMACH|DIGESTIVE',cell_line)) %>% pull(cell_line)
stomgroup <- tdat %>% filter(grepl('STOMACH|DIGESTIVE|INTESTINE',cell_line)) %>% pull(cell_line)
lunggroup <- tdat %>% filter(grepl('LUNG|PLEURA',cell_line)) %>% pull(cell_line)
utgroup <- tdat %>% filter(grepl('ENDOMETRIUM|UTERUS|OVARY',cell_line)) %>% pull(cell_line)
thygroup <- tdat %>% filter(grepl('THYROID',cell_line)) %>% pull(cell_line)
cnsgroup <- tdat %>% filter(grepl('NERVOUS|GANGLIA',cell_line)) %>% pull(cell_line)
livgroup <- tdat %>% filter(grepl('LIVER|BILIARY',cell_line)) %>% pull(cell_line)
bonegroup <- tdat %>% filter(grepl('BONE',cell_line)) %>% pull(cell_line)
pancgroup <- tdat %>% filter(grepl('PANCREAS',cell_line)) %>% pull(cell_line)
bloodgroup <- tdat %>% filter(grepl('BLOOD|HAEMAT',cell_line)) %>% pull(cell_line)
stgroup <- tdat %>% filter(grepl('SOFT',cell_line)) %>% pull(cell_line)
kidgroup <- tdat %>% filter(grepl('KIDNEY',cell_line)) %>% pull(cell_line)
skingroup <- tdat %>% filter(grepl('SKIN',cell_line)) %>% pull(cell_line)
breastgroup <- tdat %>% filter(grepl('BREAST',cell_line)) %>% pull(cell_line)
tdat <- tdat %>% mutate(cell_type = case_when(
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "LUNG",
.default = NA
))
tdat <- tdat %>% mutate(cell_type = case_when(
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "GASTROINTESTINAL",
cell_line %in% lunggroup ~ "UTERUS",
cell_line %in% lunggroup ~ "THYROID",
cell_line %in% lunggroup ~ "CNS",
cell_line %in% lunggroup ~ "LIVER",
cell_line %in% lunggroup ~ "BONE",
cell_line %in% lunggroup ~ "BLOOD",
cell_line %in% lunggroup ~ "SOFT_TISSUE",
cell_line %in% lunggroup ~ "PANCREAS",
cell_line %in% lunggroup ~ "KIDNEY",
cell_line %in% lunggroup ~ "SKIN",
cell_line %in% lunggroup ~ "BREAST",
.default = NA
))
tdat %>% filter(is.na(cell_type))
lunggroup <- tdat %>% filter(grepl('LUNG|PLEURA',cell_line)) %>% pull(cell_line)
stomgroup <- tdat %>% filter(grepl('STOMACH|DIGESTIVE|INTESTINE|OESOPHAGUS',cell_line)) %>% pull(cell_line)
utgroup <- tdat %>% filter(grepl('ENDOMETRIUM|UTERUS|OVARY',cell_line)) %>% pull(cell_line)
thygroup <- tdat %>% filter(grepl('THYROID',cell_line)) %>% pull(cell_line)
cnsgroup <- tdat %>% filter(grepl('NERVOUS|GANGLIA',cell_line)) %>% pull(cell_line)
livgroup <- tdat %>% filter(grepl('LIVER|BILIARY',cell_line)) %>% pull(cell_line)
bonegroup <- tdat %>% filter(grepl('BONE',cell_line)) %>% pull(cell_line)
bloodgroup <- tdat %>% filter(grepl('BLOOD|HAEMAT',cell_line)) %>% pull(cell_line)
stgroup <- tdat %>% filter(grepl('SOFT',cell_line)) %>% pull(cell_line)
pancgroup <- tdat %>% filter(grepl('PANCREAS',cell_line)) %>% pull(cell_line)
kidgroup <- tdat %>% filter(grepl('KIDNEY',cell_line)) %>% pull(cell_line)
skingroup <- tdat %>% filter(grepl('SKIN',cell_line)) %>% pull(cell_line)
breastgroup <- tdat %>% filter(grepl('BREAST',cell_line)) %>% pull(cell_line)
tdat <- tdat %>% mutate(cell_type = case_when(
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% lunggroup ~ "GASTROINTESTINAL",
cell_line %in% lunggroup ~ "UTERUS",
cell_line %in% lunggroup ~ "THYROID",
cell_line %in% lunggroup ~ "CNS",
cell_line %in% lunggroup ~ "LIVER",
cell_line %in% lunggroup ~ "BONE",
cell_line %in% lunggroup ~ "BLOOD",
cell_line %in% lunggroup ~ "SOFT_TISSUE",
cell_line %in% lunggroup ~ "PANCREAS",
cell_line %in% lunggroup ~ "KIDNEY",
cell_line %in% lunggroup ~ "SKIN",
cell_line %in% lunggroup ~ "BREAST",
.default = NA
))
tdat %>% filter(is.na(cell_type))
tdat <- tdat %>% mutate(cell_type = case_when(
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% stomgroup ~ "GASTROINTESTINAL",
cell_line %in% utgroup ~ "UTERUS",
cell_line %in% thygroup ~ "THYROID",
cell_line %in% cnsgroup ~ "CNS",
cell_line %in% livgroup ~ "LIVER",
cell_line %in% bonegroup ~ "BONE",
cell_line %in% bloodgroup ~ "BLOOD",
cell_line %in% stgroup ~ "SOFT_TISSUE",
cell_line %in% pancgroup ~ "PANCREAS",
cell_line %in% kidgroup ~ "KIDNEY",
cell_line %in% skingroup ~ "SKIN",
cell_line %in% breastgroup ~ "BREAST",
.default = NA
))
tdat %>% filter(is.na(cell_type))
kidgroup <- tdat %>% filter(grepl('KIDNEY|URINARY',cell_line)) %>% pull(cell_line)
tdat <- tdat %>% mutate(cell_type = case_when(
cell_line %in% lunggroup ~ "LUNG",
cell_line %in% stomgroup ~ "GASTROINTESTINAL",
cell_line %in% utgroup ~ "UTERUS",
cell_line %in% thygroup ~ "THYROID",
cell_line %in% cnsgroup ~ "CNS",
cell_line %in% livgroup ~ "LIVER",
cell_line %in% bonegroup ~ "BONE",
cell_line %in% bloodgroup ~ "BLOOD",
cell_line %in% stgroup ~ "SOFT_TISSUE",
cell_line %in% pancgroup ~ "PANCREAS",
cell_line %in% kidgroup ~ "KIDNEY",
cell_line %in% skingroup ~ "SKIN",
cell_line %in% breastgroup ~ "BREAST",
.default = NA
))
head(tdat)
ggplot(tdat)+
geom_point(aes(x=PercentMapped * 1000000, y=rnai_dependency, color=cell_type))+
theme_bw()
ggplot(tdat)+
geom_point(aes(x=PercentMapped * 1000000, y=rnai_dependency, color=cell_type), size=5)+
theme_bw()
ggplot(tdat)+
geom_point(aes(x=PercentMapped * 1000000, y=rnai_dependency, color=cell_type), size=5)+
ylab("DepMap RNAi Dependency Score")+
xlab("ORF1 TPM")+
ggtitle("Preliminary DepMap ORF1 Screen (N=100)")+
theme_bw()
ggplot(tdat)+
geom_point(aes(x=PercentMapped * 1000000, y=crispr_dependency, color=cell_type), size=5)+
ylab("DepMap CRISPR Dependency Score")+
xlab("ORF1 TPM")+
ggtitle("Preliminary DepMap ORF1 Screen (N=100)")+
theme_bw()
write_csv(tdat, "WorkForaging/technium/apeiron/orf1/prelim_orf1_depmap.csv")
mdat
write_tsv(tdat, "WorkForaging/technium/apeiron/orf1/prelim_orf1_depmap.tsv")
cor(tdat$PercentMapped, tdat$rnai_dependency)
cor(tdat$PercentMapped, tdat$rnai_dependency, na.rm=T)
cor(tdat$PercentMapped, tdat$rnai_dependency, use='pairwise.complete.obs')
cor(tdat$PercentMapped*1000000, tdat$rnai_dependency, use='pairwise.complete.obs')
cor(tdat$PercentMapped, tdat$crispr_dependency, use='pairwise.complete.obs')
library(tidyverse)
data <- readRDS('Postdoc/Hindle/ana/tmp/cor.rds')
head(data)
data %>% filter(P<.05, Rho<0) %>% rownames()
data %>% filter(P<.05, Rho<0) %>% rownames() %>% cat()
data %>% filter(P<.05, Rho>0) %>% rownames() %>% cat()
data %>% filter(P<.05, Rho<0) %>% rownames() %>% nrow()
data %>% filter(P<.05, Rho<0) %>% nrow()
data %>% filter(P<.05, Rho>0) %>% nrow()
---
title: "PureCN best practices"
library(tidyverse)
library(dada2)
library(phyloseq)
library(Biostrings)
library(colorspace)
library(vegan)
library(tidyverse)
library(phyloseq)
setwd('')
setwd('WorkForaging/Academia/Nicole/deca/')
ps <- readRDS('data/16Sdada2/phyloseq.filtered.rds')
meta <- sample_data(ps)
meta %>% filter(is.na(Treatment))
data.frame(meta) %>% filter(is.na(Treatment))
data.frame(meta) %>% pull(Treatment) %>% unique()
#import libraries and set wd
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(phyloseq)
library(vegan)
knitr::opts_knit$set(root.dir = '~/WorkForaging/Academia/Nicole/deca/')
knitr::opts_chunk$set(echo = TRUE)
treatlevs <- c("Baseline","Control","Water","N","N+Water","P","P+Water","N+P+Water")
testlevs <- data.frame(meta) %>% pull(Treatment) %>% unique()
setdiff(treatlevs, testlevs)
length(treatlevs)
length(testlevs)
setdiff(testlevs,treatlevs)
out <- readRDS('data/16Svegan/deca_nmds.rds')
ps <- readRDS('data/16Sdada2/phyloseq.filtered.rds')
getwd()
knitr::opts_knit$set(root.dir = '~/WorkForaging/Academia/Nicole/deca/')
ps <- readRDS('data/16Sdada2/phyloseq.filtered.rds')
mat <- data.frame(otu_table(ps))
timelevs <- c("Jul_2022","Nov_2022","Feb_2023", "Aug_2023","Nov_2023", "Feb_2024","Aug_2024")
treatlevs <- c("Baseline","Control","Water","N", "N+P","N+Water","P","P+Water","N+P+Water")
treatcols <- c("#E3E571","#E5AE71","#71C4E5","#53DF7B","#C0E5A4","#BCE7D6","#DF53B7","#E7BCCC","#804DEF")
mhablevs <- c("SI","SG","SSI","SSG")
mcols <- c("#B897DD","#BCDD97","#B43FEE","#78EE3F")
mshapes <- c(25,10,17,16)
meta <- data.frame(sample_data(ps)) %>%
rename(Sample=SampleID) %>%
mutate(SampleDate=factor(SampleDate, levels=timelevs)) %>%
mutate(Treatment=factor(Treatment, levels=treatlevs)) %>%
mutate(Microhabitat=factor(Microhabitat, levels=mhablevs))
head(mat)
head(mat[1:5,1:5])
meta %>% heaD()
meta %>% head()
meta %>% head() %>% filter(Surface_Subsurface=='S') %>% rownames()
smat <- meta %>% filter(Surface_Subsurface=='S') %>% rownames()
sidx <- meta %>% filter(Surface_Subsurface=='S') %>% rownames()
ssidx <- meta %>% filter(Surface_Subsurface=='SS') %>% rownames()
X <- vegdist(mat[sidx,], method='bray')
saveRDS(X, 'data/16Svegan/surface.bray.dist.rds')
X <- vegdist(mat[ssidx,], method='bray')
saveRDS(X, 'data/16Svegan/subsurface.bray.dist.rds')
ssX <- X
sX <- readRDS('data/16Svegan/surface.bray.dist.rds')
sout <- metaMDS(sX,
k=3,
wascores = T,
weakties=T,
try=50,
trymax=100,
parallel=8,
maxit=300)
saveRDS(sout, 'data/16Svegan/deca_surface_nmds.rds')
ssout <- metaMDS(sX,
k=3,
wascores = T,
weakties=T,
try=50,
trymax=100,
parallel=8,
maxit=300)
saveRDS(ssout, 'data/16Svegan/deca_surface_nmds.rds')
print(paste0("Stress of Surface NMDS model: ", sout$stress))
print(paste0("Stress of Subsurface NMDS model: ", ssout$stress))
gdat <- data.frame(sout$points)
gdat$goodness <- goodness(sout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes)+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Surface GOF")
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes[3:4])+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Surface GOF")
gdat <- data.frame(ssout$points)
gdat$goodness <- goodness(ssout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes)+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Subsurface GOF")
stressplot(ssout)
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes[3:4])+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Subsurface GOF")
gdat <- data.frame(sout$points)
gdat$goodness <- goodness(sout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_point(aes(x=MDS1, y=MDS2, color=Treatment, shape=Microhabitat),
size=3, alpha=0.85)+
theme_bw()+
theme(text = element_text(size=15))+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes)+
facet_wrap(~SampleDate)+
ggtitle('Surface MDS1 v MDS2')
gdat <- data.frame(ssout$points)
gdat$goodness <- goodness(ssout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_point(aes(x=MDS1, y=MDS2, color=Treatment, shape=Microhabitat),
size=3, alpha=0.85)+
theme_bw()+
theme(text = element_text(size=15))+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes[3:4])+
facet_wrap(~SampleDate)+
ggtitle('Subsurface MDS1 v MDS2')
gdat <- data.frame(ssout$points)
gdat$goodness <- goodness(ssout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
sidx <- meta %>% filter(Surface_Subsurface=='S') %>% rownames()
ssidx <- meta %>% filter(Surface_Subsurface=='SS') %>% rownames()
sX <- vegdist(mat[sidx,], method='bray')
saveRDS(sX, 'data/16Svegan/surface.bray.dist.rds')
ssX <- vegdist(mat[ssidx,], method='bray')
sidx <- meta %>% filter(Surface_Subsurface=='S') %>% rownames()
ssidx <- meta %>% filter(Surface_Subsurface=='SS') %>% rownames()
sX <- vegdist(mat[sidx,], method='bray')
saveRDS(sX, 'data/16Svegan/surface.bray.dist.rds')
ssX <- vegdist(mat[ssidx,], method='bray')
saveRDS(ssX, 'data/16Svegan/subsurface.bray.dist.rds')
sout <- metaMDS(sX,
k=3,
wascores = T,
weakties=T,
try=50,
trymax=100,
parallel=8,
maxit=300)
saveRDS(sout, 'data/16Svegan/deca_surface_nmds.rds')
ssout <- metaMDS(ssX,
k=3,
wascores = T,
weakties=T,
try=50,
trymax=100,
parallel=8,
maxit=300)
saveRDS(ssout, 'data/16Svegan/deca_suburface_nmds.rds')
print(paste0("Stress of Surface NMDS model: ", sout$stress))
print(paste0("Stress of Subsurface NMDS model: ", ssout$stress))
gdat <- data.frame(sout$points)
gdat$goodness <- goodness(sout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes)+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Surface GOF")
stressplot(sout)
ggplot(gdat)+
geom_point(aes(x=MDS1, y=MDS2, color=Treatment, shape=Microhabitat),
size=3, alpha=0.85)+
theme_bw()+
theme(text = element_text(size=15))+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes)+
facet_wrap(~SampleDate)+
ggtitle('Surface MDS1 v MDS2')
gdat <- data.frame(ssout$points)
gdat$goodness <- goodness(ssout)
gdat$Sample <- rownames(gdat)
gdat <- left_join(gdat, meta, by='Sample')
ggplot(gdat)+
geom_jitter(aes(x=SampleDate, y=goodness, color=Treatment, shape=Microhabitat),
size=4, height = 0, width=0.25, alpha=0.85)+
theme_bw()+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes[3:4])+
xlab("Date")+
ylab("Goodness of Fit")+
ggtitle("Subsurface GOF")
stressplot(ssout)
ggplot(gdat)+
geom_point(aes(x=MDS1, y=MDS2, color=Treatment, shape=Microhabitat),
size=3, alpha=0.85)+
theme_bw()+
theme(text = element_text(size=15))+
scale_color_manual(values = treatcols)+
scale_shape_manual(values = mshapes[3:4])+
facet_wrap(~SampleDate)+
ggtitle('Subsurface MDS1 v MDS2')
#import libraries and set wd
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(phyloseq)
library(vegan)
knitr::opts_knit$set(root.dir = '~/WorkForaging/Academia/Nicole/deca/')
knitr::opts_chunk$set(echo = TRUE)
decadist <- readRDS('data/16Svegan/bray.dist.rds')
